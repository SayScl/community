<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>注册页</title>
    <link rel="stylesheet" href="/css/register.css" />
</head>
<body>
<div class="main">
    <form id="form">
        <div>手机号码<input type="text" name="phoneNumber" id="phoneNumber" onblur="vaphoneNumber()"></input>*
            <span id="spanphoneNumber"></span>
        </div>
        <div>昵称<input type="text" name="nickname" id="nickname" ></input></div>
        <div>实名<input type="text" name="name" id="name" onblur="vaname()"></input>*
            <span id="spanname"></span>
        </div>
        <div>所在城市<select id="selectcity" onchange="getcity();vacity()" onblur="vacity()"><option>城市</option>

            <option>cd</option>
        </select>
            所在小区<select id="selectcommunity" onchange="getcommunity();vacommunity()" onblur="vacommunity()">
                <option>小区</option>
                <option>xiaoxinggong</option>

            </select>
            <span id="spancity"></span><span id="spancommunity"></span>
        </div>
        <div>详细地址<input type="text" name="address" id="address" onblur="vaaddress()"></input>*
            <span id="spanaddress"></span>
        </div>
        <div>登陆密码<input type="text" name="password" id="password" onblur="vapassword()"></input>*
            <span id="spanpassword"></span></div>
        <div>确认密码<input type="text" id="repassword" onblur="varepassword()"></input>*
            <span id="spanrepassword"></span>
        </div>
        <div>验证码<input type="text" id="validata" onblur="vavalidata()"></input>
            <span id="getNumber" onclick="time(this)">获取验证码</span>
            <span id="number"></span><span id="spanvalidata"></span>
        </div>
        <div><span style="font-size: 2em" onclick="vaphoneNumber(),vaname(),
        vacity(),vacommunity(),vaaddress(),vapassword(),vasubmit(),submit()">提交</span></div>
        <input type="hidden" name="city" id="city"></input>
        <input type="hidden" name="community" id="community" ></input>
    </form>
</div>
</body>
<script src="/jquery-3.1.1.min.js"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    var flag=true;
    //验证手机号码的有效性
    function vaphoneNumber(){
        var sMobile = $("#phoneNumber").val();
        if(!(/^1[3|4|5|8][0-9]\d{4,8}$/.test(sMobile)) || sMobile.length!=11){
            $("#spanphoneNumber").text("不是完整的11位手机号或者不是正确手机号码")
            flag=false;
            return false;
        }else{
            $("#spanphoneNumber").text("")
        }
    }
    //验证实名必填
    function vaname(){
        var name=$("#name").val();
        if(name==null || name==""){
            $("#spanname").text("实名不能为空");
            flag=false;
            return false;
        }else{
            $("#spanname").text("")
        }
    }
    //验证城市必选
    function vacity(){
        var city=$("#city").val();
        if(city==null || city=="" || city=="城市"){
            $("#spancity").text("城市不能为空");
            flag=false;
            return false;
        }else{
            $("#spancity").text("")
        }
    }
    //验证小区必选
    function vacommunity(){
        var community=$("#community").val();
        if(community==null || community=="" || community=="小区"){
            $("#spancommunity").text("小区名不能为空");
            flag=false;
            return false;
        }else{
            $("#spancommunity").text("")
        }

    }
    //验证地址必填
    function vaaddress(){
        var address=$("#address").val();
        if(address==null || address==""){
            $("#spanaddress").text("地址不能为空");
            flag=false;
            return false;
        }else{
            $("#spanaddress").text("");
        }
    }
    //验证密码必填
    function vapassword(){
        var password=$("#password").val();
        if(password==null || password==""){
            $("#spanpassword").text("密码不能为空");
            flag=false;
            return false;
        }else{
            $("#spanpassword").text("");
        }
    }
    //验证确认密码必填
    function varepassword(){
        var password=$("#password").val();
        var repassword=$("#repassword").val();
        if(repassword==null || repassword==""){
            $("#spanrepassword").text("确认密码不能为空");
            flag=false;
            return false;
        }else{
            if(password===repassword){
                $("#spanrepassword").text("密码可用")
            }else{
                $("#spanrepassword").text("两次密码不一致");
                flag=false;
                return false;
            }
        }
    }


    //获取城市数据放入hidden中
    function getcity(){
        $("#city").val($("#selectcity").find("option:selected").text());
    }
    //获取小区数据放入hidden中
    function getcommunity(){
        $("#community").val($("#selectcommunity").find("option:selected").text());
    }

    //获得随机验证码
    var wait=0;
    var number;
    function time(o) {
        if (wait == 0) {
            var ran=Math.random()*9999+1000;
            number=parseInt(ran);
            $("#number").text(number);
            wait = 60;
            o.setAttribute("disabled", true);
            var interval=setInterval(function() {
                    wait--;
                    $("#getNumber").text("("+wait + "）后重新获取")
                    if(wait==0){
                        o.removeAttribute("disabled");
                        $("#getNumber").text("获取验证码")
                        clearInterval(interval);
                    }
                },
                1000)
        }

    }

    //验证码是否正确
    function vavalidata(){
        var validata=$("#validata").val();
        if(validata==null ||validata==""){
            $("#spanvalidata").text("请输入验证码");
            flag=false;
            return false;
        }else{
            if(validata==number){
                $("#spanvalidata").text("验证码正确");
            }else{
                $("#spanvalidata").text("验证码有误");
                flag=false;
                return false;
            }
        }
    }

    function vasubmit(){
        if(!flag){
            return false;
        }
    }


    //提交
    function submit(){
        var formdata=$("#form").serialize();
        $.ajax({
            type:"post",
            url:"/user/register",
            data:formdata,
            success: function (data) {
                if(data=="success"){
                    alert("注册成功")
                    window.location.href="/"
                }else{
                    alert("注册失败")
                }
            }
    });
    }

    /*]]> */
</script>
</html>